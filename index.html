<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dịch vụ in 3D FDM – TIMI 3D PRINT STUDIO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #217fbe;
            --secondary-color: #fcd739;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: #333;
            scroll-behavior: smooth;
        }
        .bg-primary { background-color: var(--primary-color); }
        .text-primary { color: var(--primary-color); }
        .border-primary { border-color: var(--primary-color); }
        .hover-shadow:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* Custom progress bar styles */
        .stat-bar { height: 8px; border-radius: 4px; background: #e2e8f0; position: relative; overflow: hidden; }
        .stat-fill { height: 100%; border-radius: 4px; transition: width 0.5s ease-out; }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Top Bar -->
    <div class="bg-zinc-800 text-white py-2 text-center text-sm md:text-base">
        <div class="container mx-auto px-4 uppercase tracking-wider font-medium">
            TIMI 3D PRINT STUDIO • C11-36, đường số 7, KĐT TÂY BẮC, P. RẠCH GIÁ, AN GIANG • Hotline: <a href="tel:0917777897" class="font-bold text-secondary-color">0917 777 897</a>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 h-20 md:h-24 flex items-center justify-between">
            <a href="#" class="flex items-center space-x-2">
                <div class="text-2xl md:text-3xl font-black text-primary italic uppercase tracking-tighter">TIMI 3D <span class="text-zinc-800">PRINT STUDIO</span></div>
            </a>
            <nav class="hidden md:flex space-x-4">
                <a href="#" class="bg-primary text-white px-6 py-2 rounded-full font-medium hover:bg-blue-700 transition">Trang chủ <i class="fas fa-star ml-1"></i></a>
                <a href="#contact" class="bg-green-600 text-white px-6 py-2 rounded-full font-medium hover:bg-green-700 transition">Liên hệ <i class="fas fa-phone ml-1"></i></a>
            </nav>
            <button class="md:hidden text-2xl text-zinc-800">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="py-12 md:py-20 bg-white">
        <div class="container mx-auto px-4 flex flex-col md:flex-row items-center">
            <div class="md:w-7/12 mb-10 md:mb-0">
                <h1 class="text-4xl md:text-5xl font-bold mb-4">Dịch vụ in 3D</h1>
                <h2 class="text-2xl md:text-3xl text-primary font-bold mb-6 italic uppercase">TIMI 3D PRINT STUDIO</h2>
                <div class="w-20 h-1 bg-primary mb-6"></div>
                <p class="text-lg text-gray-600 mb-6 leading-relaxed">
                    Chúng tôi cung cấp dịch vụ in 3D FDM chuyên nghiệp với chính sách giá nhựa ưu đãi, độ chính xác cao, đáp ứng đầy đủ nhu cầu tạo mẫu sản phẩm in 3D và sản xuất số lượng nhỏ tại khu vực Rạch Giá, An Giang.
                </p>
                <div class="flex flex-col sm:flex-row gap-4 mb-6">
                    <div class="bg-blue-50 px-4 py-2 rounded-lg border border-blue-100 text-sm font-medium text-primary">
                        <i class="fas fa-expand mr-2"></i> Khổ in: 400 x 400 x 400mm
                    </div>
                    <div class="bg-green-50 px-4 py-2 rounded-lg border border-green-100 text-sm font-medium text-green-700">
                        <i class="fas fa-bolt mr-2"></i> Báo giá nhanh trong 30p
                    </div>
                </div>
            </div>
            <div class="md:w-5/12">
                <!-- Updated Hero Image with optimized ratio -->
                <div class="rounded-3xl overflow-hidden shadow-2xl aspect-[4/3] border-4 border-white">
                    <img src="https://images.unsplash.com/photo-1642969164999-979483e21601?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="TIMI 3D PRINT STUDIO Hero Image" class="w-full h-full object-cover" onerror="this.src='https://placehold.co/600x450?text=TIMI+3D+PRINT+STUDIO'">
                </div>
            </div>
        </div>
    </section>

    <!-- Pricing Section -->
    <section class="py-16 bg-gray-50">
        <div class="container mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold inline-block border-b-4 border-primary pb-2 uppercase">Bảng giá dịch vụ in 3D</h2>
                <p class="text-gray-500 mt-4 italic text-lg">* Miễn phí tiền công in - Chỉ tính tiền nhựa in</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
                <!-- Detailed Filament Prices -->
                <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100 lg:col-span-2">
                    <h3 class="text-xl font-bold mb-6 text-center uppercase tracking-wide">Bảng giá nhựa in 3D (Phân tầng)</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="p-4 border-b">Loại vật liệu</th>
                                    <th class="p-4 border-b text-red-600">Dưới 300 Gram</th>
                                    <th class="p-4 border-b text-green-600">Trên 300 Gram</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                <tr>
                                    <td class="p-4 font-bold">PETG</td>
                                    <td class="p-4">1.000đ/g</td>
                                    <td class="p-4 text-primary font-bold">550đ/g</td>
                                </tr>
                                <tr>
                                    <td class="p-4 font-bold">PLA</td>
                                    <td class="p-4">1.100đ/g</td>
                                    <td class="p-4 text-primary font-bold">650đ/g</td>
                                </tr>
                                <tr>
                                    <td class="p-4 font-bold">ABS / ASA / TPU</td>
                                    <td class="p-4">1.200đ/g</td>
                                    <td class="p-4 text-primary font-bold">750đ/g</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-4 p-4 bg-red-50 text-red-700 rounded-lg text-sm font-medium border border-red-100">
                        <i class="fas fa-info-circle mr-2"></i> <strong>Lưu ý:</strong> Giá tối thiểu cho mỗi mẫu in là <strong>20.000đ</strong> (áp dụng cho các mẫu quá nhỏ/nhẹ).
                    </div>
                </div>

                <!-- Calculation Card -->
                <div class="bg-zinc-800 text-white p-8 rounded-2xl shadow-md">
                    <h3 class="text-xl font-bold mb-4 uppercase tracking-wide text-secondary-color">Công thức tính</h3>
                    <div class="text-2xl font-black mb-6 border-b border-zinc-700 pb-4">
                        Giá = Khối lượng x Đơn giá
                    </div>
                    <h4 class="text-lg font-bold mb-3">Ưu đãi tổng đơn:</h4>
                    <ul class="space-y-3 text-sm text-zinc-300">
                        <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-2"></i> Giảm 5% đơn > 500.000đ</li>
                        <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-2"></i> Giảm 10% đơn > 1.000.000đ</li>
                        <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-2"></i> Giảm 15% đơn > 1.500.000đ</li>
                    </ul>
                </div>
            </div>

            <!-- QUICK CALCULATOR TOOL -->
            <div class="max-w-4xl mx-auto bg-white rounded-3xl shadow-xl overflow-hidden border border-blue-100">
                <div class="bg-primary p-6 text-white text-center">
                    <h3 class="text-2xl font-bold uppercase"><i class="fas fa-calculator mr-2"></i> Công cụ tính giá nhanh</h3>
                    <p class="text-blue-100 text-sm mt-1">Hệ thống tự động áp dụng đơn giá theo khối lượng mẫu</p>
                </div>
                <div class="p-8 grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Chọn loại nhựa</label>
                            <select id="calc-material" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition">
                                <option value="petg">Nhựa PETG</option>
                                <option value="pla">Nhựa PLA</option>
                                <option value="abs">Nhựa ABS / ASA / TPU</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Khối lượng mẫu cần in (Gram)</label>
                            <div class="relative">
                                <input type="number" id="calc-weight" placeholder="VD: 350" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition text-xl font-bold text-primary">
                                <span class="absolute right-4 top-4 text-gray-400 font-bold">g</span>
                            </div>
                            <p id="calc-rate-info" class="text-xs text-blue-600 mt-2 italic font-medium">Vui lòng nhập khối lượng...</p>
                        </div>
                        <!-- Hidden Member Code Input -->
                        <div class="pt-4 border-t border-gray-100">
                            <input type="password" id="calc-password" placeholder="Mã ưu đãi CTV" class="w-full text-xs p-2 bg-gray-100 border-none rounded focus:ring-1 focus:ring-gray-300 outline-none text-gray-400">
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-6 rounded-2xl flex flex-col justify-center border border-blue-100 relative">
                        <h4 class="text-center text-gray-500 uppercase text-xs font-bold tracking-widest mb-4">Chi tiết thanh toán</h4>
                        
                        <div class="space-y-3 mb-6">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Thành tiền tạm tính:</span>
                                <span id="res-subtotal" class="font-bold text-gray-800">0đ</span>
                            </div>
                            <div class="flex justify-between text-sm text-green-600 font-medium">
                                <span>Chiết khấu đơn hàng:</span>
                                <span id="res-discount">-0đ</span>
                            </div>
                            <!-- Minimum Price Warning -->
                            <div id="min-price-warning" class="hidden text-center p-2 bg-red-100 text-red-600 rounded-lg text-[10px] font-bold uppercase mt-2">
                                <i class="fas fa-exclamation-triangle mr-1"></i> Đã áp dụng giá tối thiểu 20.000đ
                            </div>
                            <!-- CTV Result Area -->
                            <div id="ctv-row" class="hidden flex justify-between text-sm p-3 bg-white rounded-lg border border-dashed border-primary mt-4">
                                <span class="text-primary font-bold"><i class="fas fa-handshake mr-1"></i> Giá CTV (-30%):</span>
                                <span id="res-ctv" class="font-bold text-primary">0đ</span>
                            </div>
                        </div>

                        <div class="border-t border-blue-200 pt-4 text-center">
                            <div id="res-total" class="text-4xl font-black text-primary">0đ</div>
                            <p id="res-note" class="text-xs text-gray-400 mt-2 italic">* Đã bao gồm phí chuẩn bị mẫu in</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Specs & Comparison Section -->
    <section class="py-16 bg-white">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
                <!-- Column 1: Specs -->
                <div>
                    <h4 class="text-2xl font-bold mb-6 uppercase text-center md:text-left">Tham số in 3D chuẩn</h4>
                    <div class="space-y-3 bg-gray-50 p-6 rounded-xl border-l-4 border-primary">
                        <p>• Acceleration: <strong>2000mm/s²</strong></p>
                        <p>• Speed: <strong>50mm/s</strong></p>
                        <p>• Travel: <strong>100mm/s</strong></p>
                        <p>• Shell: <strong>1.2mm</strong></p>
                        <p>• Support: <strong>Normal (Auto)</strong></p>
                        <p>• Minimal layer time: <strong>10s</strong></p>
                    </div>
                </div>

                <!-- Column 2-3: Filament Comparison -->
                <div class="lg:col-span-2">
                    <h4 class="text-2xl font-bold mb-6 uppercase text-center md:text-left">So sánh đặc tính sợi nhựa</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        
                        <!-- PLA Card -->
                        <div class="bg-gray-50 p-5 rounded-2xl border border-gray-100">
                            <div class="flex justify-between items-center mb-4">
                                <h5 class="text-lg font-bold text-green-600">PLA</h5>
                                <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">Dễ in nhất</span>
                            </div>
                            <div class="space-y-3 text-sm">
                                <div>
                                    <div class="flex justify-between mb-1"><span>Độ bền:</span> <span class="font-bold italic">Trung bình</span></div>
                                    <div class="stat-bar"><div class="stat-fill bg-green-500" style="width: 60%"></div></div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-1"><span>Chịu nhiệt:</span> <span class="font-bold italic">Kém (50°C)</span></div>
                                    <div class="stat-bar"><div class="stat-fill bg-red-400" style="width: 30%"></div></div>
                                </div>
                                <p class="text-xs text-gray-500 pt-2 leading-relaxed">Phù hợp in mô hình, đồ chơi, vật trang trí trong nhà, chi tiết yêu cầu độ thẩm mỹ cao.</p>
                            </div>
                        </div>

                        <!-- PETG Card -->
                        <div class="bg-gray-50 p-5 rounded-2xl border border-gray-100">
                            <div class="flex justify-between items-center mb-4">
                                <h5 class="text-lg font-bold text-blue-600">PETG</h5>
                                <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">Cân bằng nhất</span>
                            </div>
                            <div class="space-y-3 text-sm">
                                <div>
                                    <div class="flex justify-between mb-1"><span>Độ bền:</span> <span class="font-bold italic">Tốt</span></div>
                                    <div class="stat-bar"><div class="stat-fill bg-blue-500" style="width: 80%"></div></div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-1"><span>Chịu nhiệt:</span> <span class="font-bold italic">Ổn (75°C)</span></div>
                                    <div class="stat-bar"><div class="stat-fill bg-blue-400" style="width: 60%"></div></div>
                                </div>
                                <p class="text-xs text-gray-500 pt-2 leading-relaxed">Vật liệu phổ biến nhất cho cơ khí, đồ dùng gia đình, chi tiết cần độ bền và chịu lực vừa phải.</p>
                            </div>
                        </div>

                        <!-- ABS/ASA Card -->
                        <div class="bg-gray-50 p-5 rounded-2xl border border-gray-100">
                            <div class="flex justify-between items-center mb-4">
                                <h5 class="text-lg font-bold text-orange-600">ABS / ASA</h5>
                                <span class="text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded">Chịu nhiệt cao</span>
                            </div>
                            <div class="space-y-3 text-sm">
                                <div>
                                    <div class="flex justify-between mb-1"><span>Độ bền:</span> <span class="font-bold italic">Rất tốt</span></div>
                                    <div class="stat-bar"><div class="stat-fill bg-orange-500" style="width: 85%"></div></div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-1"><span>Chịu nhiệt:</span> <span class="font-bold italic">Cao (100°C)</span></div>
                                    <div class="stat-bar"><div class="stat-fill bg-orange-400" style="width: 90%"></div></div>
                                </div>
                                <p class="text-xs text-gray-500 pt-2 leading-relaxed">Lựa chọn hàng đầu cho linh kiện ô tô, đồ dùng ngoài trời, môi trường khắc nghiệt và nắng nóng.</p>
                            </div>
                        </div>

                        <!-- TPU Card -->
                        <div class="bg-gray-50 p-5 rounded-2xl border border-gray-100">
                            <div class="flex justify-between items-center mb-4">
                                <h5 class="text-lg font-bold text-purple-600">TPU (Nhựa dẻo)</h5>
                                <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded">Siêu bền</span>
                            </div>
                            <div class="space-y-3 text-sm">
                                <div>
                                    <div class="flex justify-between mb-1"><span>Độ bền:</span> <span class="font-bold italic">Khó phá hủy</span></div>
                                    <div class="stat-bar"><div class="stat-fill bg-purple-500" style="width: 95%"></div></div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-1"><span>Độ linh hoạt:</span> <span class="font-bold italic">Như cao su</span></div>
                                    <div class="stat-bar"><div class="stat-fill bg-purple-400" style="width: 100%"></div></div>
                                </div>
                                <p class="text-xs text-gray-500 pt-2 leading-relaxed">Dùng cho gioăng cao su, ốp điện thoại, đệm giảm chấn, các chi tiết cần co giãn và chịu va đập mạnh.</p>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Ordering Guide -->
    <section class="py-16 bg-gray-50">
        <div class="container mx-auto px-4">
            <div class="text-center mb-16">
                <h2 class="text-3xl font-bold inline-block border-b-4 border-primary pb-2 uppercase">Hướng dẫn đặt hàng</h2>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Step 1 -->
                <div class="bg-white p-6 rounded-2xl shadow-sm hover-shadow transition text-center">
                    <div class="w-12 h-12 bg-primary text-white rounded-full flex items-center justify-center text-xl font-bold mx-auto mb-4">1</div>
                    <h4 class="font-bold text-lg mb-3">Gửi file in 3D</h4>
                    <p class="text-sm text-gray-600 mb-4">Zalo: <a href="https://zalo.me/0917777897" class="text-primary font-bold">0917 777 897</a></p>
                    <p class="text-xs text-gray-400 italic">Định dạng: STL, 3MF, STEP, STP, IGES...</p>
                </div>

                <!-- Step 2 -->
                <div class="bg-white p-6 rounded-2xl shadow-sm hover-shadow transition text-center">
                    <div class="w-12 h-12 bg-primary text-white rounded-full flex items-center justify-center text-xl font-bold mx-auto mb-4">2</div>
                    <h4 class="font-bold text-lg mb-3">Thông số mẫu in</h4>
                    <p class="text-sm text-gray-600 mb-2">Chọn chất liệu & Màu sắc.</p>
                    <p class="text-xs text-gray-400">Layer: 0.1 - 0.3mm | Infill: 10% - 100%</p>
                </div>

                <!-- Step 3 -->
                <div class="bg-white p-6 rounded-2xl shadow-sm hover-shadow transition text-center">
                    <div class="w-12 h-12 bg-primary text-white rounded-full flex items-center justify-center text-xl font-bold mx-auto mb-4">3</div>
                    <h4 class="font-bold text-lg mb-3">Nhận báo giá</h4>
                    <p class="text-sm text-gray-600">Chúng tôi báo giá chính xác dựa trên khối lượng file thực tế.</p>
                </div>

                <!-- Step 4 -->
                <div class="bg-white p-6 rounded-2xl shadow-sm hover-shadow transition text-center">
                    <div class="w-12 h-12 bg-primary text-white rounded-full flex items-center justify-center text-xl font-bold mx-auto mb-4">4</div>
                    <h4 class="font-bold text-lg mb-3">Gia công & Nhận hàng</h4>
                    <p class="text-sm text-gray-600 mt-2 font-medium text-green-600">In ngay sau khi khách xác nhận!</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer / Contact -->
    <footer id="contact" class="bg-zinc-900 text-white pt-16">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row gap-12 pb-16">
                <div class="md:w-5/12 text-center md:text-right">
                    <h2 class="text-3xl md:text-4xl font-black text-primary italic mb-4 uppercase">TIMI 3D <span class="text-white">PRINT STUDIO</span></h2>
                    <p class="text-xl font-bold mb-6 uppercase tracking-wide">DỊCH VỤ IN 3D FDM</p>
                    <div class="space-y-4 text-gray-400">
                        <p><strong>Địa chỉ:</strong> C11-36, đường số 7, KĐT TÂY BẮC, P. RẠCH GIÁ, AN GIANG</p>
                        <p><strong>Số điện thoại:</strong> <a href="tel:0917777897" class="text-white hover:text-primary transition">0917 777 897</a></p>
                        <p><strong>Zalo:</strong> <a href="https://zalo.me/0917777897" class="text-white hover:text-primary transition">0917 777 897</a></p>
                        <p><strong>Facebook:</strong> <a href="https://facebook.com/in3drga" class="text-white hover:text-primary transition" target="_blank">facebook.com/in3drga</a></p>
                    </div>
                </div>
                <div class="md:w-7/12">
                    <div class="bg-zinc-800 rounded-2xl p-2 h-[400px] shadow-inner">
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3928.324231456234!2d105.074321!3d10.015234!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zMTDCsDAwJzU0LjgiTiAxMDXCsDA0JzI3LjYiRQ!5e0!3m2!1svi!2s!4v1650530000000!5m2!1svi!2s" width="100%" height="100%" style="border:0; border-radius: 12px;" allowfullscreen="" loading="lazy"></iframe>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Back to top -->
    <a href="#" class="fixed bottom-6 right-6 bg-primary text-white w-12 h-12 rounded-full flex items-center justify-center shadow-lg hover:bg-blue-700 transition z-40">
        <i class="fas fa-angle-up"></i>
    </a>

    <script>
        // Cấu hình giá nhựa theo mốc 300g
        const pricing = {
            petg: { under: 1000, over: 550 },
            pla: { under: 1100, over: 650 },
            abs: { under: 1200, over: 750 }
        };

        const MIN_PRICE = 20000; // GIÁ TỐI THIỂU CHO 1 MẪU IN
        const CTV_PASSWORD = "123456";

        const materialEl = document.getElementById('calc-material');
        const weightEl = document.getElementById('calc-weight');
        const passwordEl = document.getElementById('calc-password');
        const rateInfoEl = document.getElementById('calc-rate-info');
        
        const resSubtotal = document.getElementById('res-subtotal');
        const resDiscount = document.getElementById('res-discount');
        const resTotal = document.getElementById('res-total');
        const ctvRow = document.getElementById('ctv-row');
        const resCtv = document.getElementById('res-ctv');
        const minPriceWarning = document.getElementById('min-price-warning');

        function formatVND(amount) {
            return new Intl.NumberFormat('vi-VN').format(Math.round(amount)) + 'đ';
        }

        function calculate() {
            const materialType = materialEl.value;
            const weight = parseFloat(weightEl.value) || 0;
            const password = passwordEl.value;
            
            if (weight <= 0) {
                rateInfoEl.innerText = "Vui lòng nhập khối lượng...";
                resSubtotal.innerText = '0đ';
                resDiscount.innerText = '-0đ';
                resTotal.innerText = '0đ';
                ctvRow.classList.add('hidden');
                minPriceWarning.classList.add('hidden');
                return;
            }

            // Chọn đơn giá theo mốc 300g
            let rate = 0;
            if (weight >= 300) {
                rate = pricing[materialType].over;
                rateInfoEl.innerText = `Đơn giá ưu đãi (>= 300g): ${rate}đ/g`;
                rateInfoEl.className = "text-xs text-green-600 mt-2 italic font-bold";
            } else {
                rate = pricing[materialType].under;
                rateInfoEl.innerText = `Đơn giá chuẩn (< 300g): ${rate}đ/g`;
                rateInfoEl.className = "text-xs text-red-600 mt-2 italic font-bold";
            }

            // Tính thành tiền ban đầu
            let subtotal = weight * rate;
            let discount = 0;

            // Chiết khấu đơn hàng lớn cho khách lẻ
            if (subtotal > 1500000) discount = subtotal * 0.15;
            else if (subtotal > 1000000) discount = subtotal * 0.1;
            else if (subtotal > 500000) discount = subtotal * 0.05;

            let finalTotal = subtotal - discount;

            // KIỂM TRA GIÁ TỐI THIỂU
            if (finalTotal > 0 && finalTotal < MIN_PRICE) {
                finalTotal = MIN_PRICE;
                minPriceWarning.classList.remove('hidden');
            } else {
                minPriceWarning.classList.add('hidden');
            }

            // Cập nhật UI Khách lẻ
            resSubtotal.innerText = formatVND(subtotal);
            resDiscount.innerText = '-' + formatVND(discount);
            resTotal.innerText = formatVND(finalTotal);

            // Xử lý logic Cộng tác viên (Giảm thêm 30%)
            if (password === CTV_PASSWORD) {
                ctvRow.classList.remove('hidden');
                const ctvFinal = finalTotal * 0.7;
                resCtv.innerText = formatVND(ctvFinal);
            } else {
                ctvRow.classList.add('hidden');
            }
        }

        [materialEl, weightEl, passwordEl].forEach(el => {
            el.addEventListener('input', calculate);
        });
    </script>
</body>
</html>
